# 운영체제

- 모든 프로그램은 하드웨어를 필요로 한다.
    - 예를 들어 1+2를 계산하는 프로그램은 CPU를 필요로 한고, 이미지를 하드 디스크에 저장하는 프로그램은 하드 디스크를 필요로 한다.
- 프로그램 실행에 마땅히 필요한 요소들을 가리켜 **시스템 자원** 혹은 **자원**이라고 한다.
- 여기서 실행할 프로그램에 필요한 자원을 할당하고, 프로그램이 올바르게 실행되도록 돕는 특별한 프로그램이 바로 **운영체제**이다.

운영체제는 인터넷 브라우저, 게임과 같은 프로그램이다. 

- 다만, 운영체제는 매우 특별한 프로그램이기 때문에 항상 컴퓨터가 부팅될 때 메모리 내 **커널 영역**이라는 공간에 따로 적제됨.
- 커널 영역을 제외한 나머지 영역, 사용자가 이용하는 응용 프로그램이 적재되는 영역을 **사용자 영역**이라 함.
- 즉, 운영체제는 커널 영역에 적재되어 사용자 영역에 적재된 프로그램들에 자원을 할당하고 올바르게 실행되도록 돕는다.

*예를 들어, 우리가 워드 프로세서, 인터넷 브라우저, 메모장을 설치했을 때 이러한 프로그램들은 사용자 영역에 적재되어 있는 것이다. 이러한 프로그램들은 메모리 주소에 적재가 되는데, 주소가 겹치지 않도록 조절하며 적재하는 것이 운영체제의 역할이다.

> 운영체제는 실행할 프로그램을 메모리에 적재하고, 더 이상 실행되지 않는 프로그램을 메모리에서 삭제하며 지속적으로 메모리 자원을 관리.
> 

또한, 이러한 응용 프로그램이 실행되려면 반드시 CPU가 필요하다. 운영체제는 최대한 공정하게 여러 프로그램에 CPU 자원을 할당한다.  운영체제 또한 관리할 자원별로 기능이 나누어져 있다. 운영체제의 어느 한 부분에서는 CPU를, 어느 곳은 메모리를, 어느 곳은 하드 디스크를 관리한다.

## 커널

- 운영체제는 현존하는 프로그램 중 규모가 가장 큰 프로그램 중 하나다.
- 자원에 접근하는 조작하는 기능, 프로그램이 올바르게 실행되게 하는 기능이 운영체제의 핵심 서비스인데, 이러한 운영체제의 핵심 서비스를 담당하는 부분을 커널이라고 한다.
- 커널은 운영체제의 핵심 기능을 담당한다.
- 커널은 모든 기기에 있으며 어떤 커널을 사용하는지에 따라 하드웨어를 이용하는 양상이 달라지거나 컴퓨터 전체의 성능도 달라진다.

### 커널 제공 서비스

- 커널에 포함되어 있지 않는 서비스(그렇다고 운영체제가 제공하지 않는 다는 건 아니다.)는 대표적으로 사용자 인터페이스가 있다. 윈도우의 바탕화면과 같이 사용자가 컴퓨터와 상호작용할 수 있는 통로이다.
    - 운영체제가 제공하는 사용자 인터페이스 종류 중에는 윈도우 바탕화면이나 스마트폰의 화면처럼 그래픽을 기반으로 컴퓨터와 상호작용할 수 있는 인터페이스인 **그래픽 유저 인터페이스**가 있다.
    - 또 다른 사용자 인터페이스로는 명령어를 기반으로 컴퓨터와 상호작용하는 **커맨드 라인 인터페이스**가 있다.
    - 마우스, 혹은 손으로 이러한 것을 실행할 수 있는 것은 그래픽 유저 인터페이스를 지원하기 때문.

## 이중 모드와 시스템 호출

- 운영체제는 사용자가 실행하는 응용 프로그램이 하드웨어 자원에 직접 접근하는 것을 방지하여 자원을 보호함.
    - 예를 들어 응용 프로그램이 실행 과정에서 하드 디스크에 접근하여 데이터를 저장하기 위해선 운영체제가 커널 영역 내의 하드 디스크에 데이터를 저장하는 코드를 실행하여 응용 프로그램의 작업을 대신 수행해야 한다.
- **이중모드**란 CPU가 명령어를 실행하는 모드를 크게 **사용자 모드**와 **커널 모드**로 구분하는 방식이다.

**사용자 모드**

- 사용자 모드는 운영체제 서비스를 제공 받을 수 없는 실행 모드이다.
- 커널 영역의 코드를 실행할 수 없다.
- 일반적인 응용 프로그램은 기본적으로 사용자 모드로 실행된다.
- 사용자 모드로 실행 중인 CPU는 입출력 명령어와 같이 하드웨어 자원에 접근하는 명령어를 실행할 수 없다.
- 자원에 접근할 수 없다.

**커널모드**

- 운영체제 서비스를 제공받을 수 있는 실행 모드이다.
- 커널 영역의 코드를 실행할 수 있다.
- 커널 모드의 CPU는 명령어를 실행하면 자원에 접근하는 명령어를 비롯한 모든 명령어를 실행할 수 있다.
- 자원에 접근할 수 있다.

**시스템 호출**

- 사용자 모드로 실행되는 프로그램이 자원의 접근을 위해선 운영체제가 커널 모드를 요청해야 한다.
- 이러한 운영체제 서비스를 제공받기 위한 요청을 **시스템 호출(SYSTEM CALL)**이라고 한다.
- 시스템 호출은 소프트웨어적인 인터럽트이다.
- 입출력 장치에 의해 발생하기도 하지만 인터럽트를 발생시키는 특정 명령어에 의해 발생하기도 하는데, 이를 **소프트웨어 인터럽트**라고 한다.

<aside>
💡 인터럽트란?
인터럽트(Interrupt)는 마이크로프로세서(CPU)가 프로그램을 실행하고 있을 때, 입출력 하드웨어 등의 장치에 예외 상황이 발생하여 처리가 필요할 경우에 마이크로프로세서에게 알려 처리할 수 있도록 하는 것을 말합니다.

</aside>

1. 하드 디스크에 데이터를 저장하는 시스템 호출을 발생켜 커널 모드로 전환.
2. 운영체제 내의 하드 디스크에 데이터를 저장하는 코드를 실행하여 하드 디스크에 접근
3. 하드 디스크에 접근이 끝났다면 다시 사용자 모드로 복귀해 실행을 진행.

→ 이러한 과정을 지나며 사용자 모드와 커널 모드를 계속 왔다갔다 함.

## 운영체제의 핵심 서비스

- 운영체제의 핵심 서비스는 **프로세스 관리, 자원 접근 및 할당, 파일 시스템 관리**이다.

### 프로세스 관리

- 실행중인 프로그램을 프로세스라고 한다.
- 컴퓨터를 사용하는 동안 메모리 안에서 새로운 프로세스들이 생성되고, 사용하지 않는 프로세스는 메모리에서 삭제된다.
- 하나의 CPU는 한번에 하나의 프로세스만 실행할 수 있기에 CPU는 이 프로세스들을 번갈아 가며 실행함.
- 각 프로세스가 사용하는 자원도 다양함.
    - 입출력 장치를 주로 사용하는 프로세스, CPU만을 주로 사용하는 프로세스 등 당장 실행할 수 있는 프로세스가 있고 사용할 수 없는 프로세스들이 있다.

### 자원 접근 및 할당

- 모든 프로세스는 실행을 위해 자원을 필요로 함.
- 운영체제는 프로세스들이 사용할 자원에 접근하고 조작하여 프로세스에게 자원을 할당함.

******CPU******

- 하나의 CPU에는 하나의 프로세스만 실행할 수 있다.
- 운영체제는 프로세스들이 공정히 CPU에 할당하기 위해 어떤 프로세스부터 CPU를 이용할 것인지 등에 대한 CPU의 스케줄을 정하는데, 이를 **CPU 스케줄링**이라고 한다.
- 이에 관한 것은 11장에 서술

**메모리**

- 메모리에 적재된 프로세스들은 크기도, 주소도 다르다. 같은 프로세스여도 실행할 때마다 주소가 달라진다.
- 매번 새로 실행할 때 마다 어느 주소에 적재할 지 운영체제는 정해야 한다.
- 이에 관한 것은 14장에 서술

**입출력장치**

- 입터럽트 서비스 루틴은 운영체제가 제공하는 기능으로 커널 영역에 있음.
- 입출력 장치가 발생시키는 하드웨어 인터럽트도 마찬가지.
- 입출력 장치가 CPU에 하드웨어 인터럽트 요청 신호를 보내면 CPU는 하던 일을 백업 후 커널 영역에 있는 인터럽트 서비스 루틴을 실행함.
- 운영체제는 인터럽트를 처리하는 프로그램, 즉 인터럽트 서비스 루틴을 제공함으로써 입출력 작업을 수행.

### 가상머신

- 소프트웨어적으로 만들어낸 가상 컴퓨터임.
- 컴퓨터에 설치된 운영체제에서 가상 머신을 설치 및 실행한다면, 가상 머신 또한 응용 프로그램이라 사용자 모드로 작동한다. 마찬가지로 가상 머신 상에 설치된 운영체제 또한 사용자 모드로 작동된다. 하지만 이럴 경우 운영체제 서비스를 제공받기 어렵다.
    - 그래서 가상화를 지원하는 CPU는 커널 모드와 사용자 모드 이외에 가상 머신을 위한 모드인 하이퍼 바이저 모드를 따로 둔다. 해당 모드를 통해 가상 머신에 설치된 운영체제로부터 운영체제 서비스를 받을 수 있다.

### 시스템 호출의 종류

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/970ff13a-5200-405b-aefb-11bbe7b980e7/b135c331-5e9e-4cdc-b8df-98555b989882/Untitled.png)
