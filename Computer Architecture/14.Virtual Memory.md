# Chapter14 가상 메모리
<br>

## 14-1 연속 메모리 할당
### 스와핑
- 메모리에서 사용되지 않는 일부 프로세스를 보조기억장치로 내보내고 실행할 프로세스를 메모리로 들여보내는 메모리 관리 기법
- 프로세스들이 쫓겨나는 보조기억장치의 일부 영역을 **스왑 영역**
- 현재 실행되지 않는 프로세스가 메모리에서 스왑 영역으로 옮겨지는 것을 **스왑 아웃**, 반대로 스왑 영역에 있던 프로세스가 다시 메모리로 옮겨오는 것을 **스왑 인**
  - 스왑 아웃 되었던 프로세스가 다시 스왑 인이 될 때는 스왑 아웃되기 전의 물리 주소와는 다른 주소에 적재될 수 있음
- 스와핑을 이용하면 프로세스들이 요구하는 메모리 주소 공간의 크기가 실제 메모리 크기보다 큰 경우에도 프로세스들을 동시 실행할 수 있음
- 유닉스와 리눅스, macOS에서는 free, top 명령어 등을 통해 스왑 영역의 크기를 확인할 수 있으며, 스왑 영역의 크기와 사용 여부는 사용자가 임의로 설정할 수 있음

<br>

### 메모리 할당
- 최초 적합
  - 운영체제가 메모리 내의 빈 공간을 순서대로 검색하다가 적재할 수 있는 공간을 발견하면 그 공간에 프로세스를 배치하는 방식
  - 즉 운영체제가 빈 공간 A → 빈 공간 B → 빈 공간 C 순으로 빈 공간을 검색했다면 프로세스는 빈 공간 A에 적재
  - 최초 적합 방식은 프로세스가 적재될 수 있는 공간을 발견하는 즉시 메모리를 할당하는 방식이므로 검색을 최소화할 수 있고 결과적으로 빠른 할당이 가능

<br>

- 최적 적합
  - 운영체제가 빈 공간을 모두 검색해 본 후, 프로세스가 적재될 수 있는 공간 중 가장 작은 공간에 프로세스를 배치하는 방식

<br>

- 최악 적합
  - 운영체제가 빈 공간을 모두 검색해 본 후, 프로세스가 적재될 수 있는 공간 중 가장 큰 공간에 프로세스를 배치하는 방식
  - 앞선 예시에서 프로세스가 적재될 수 있는 빈 공간 중 가장 큰 공간은 빈 공간 B입니다. 그렇기에 최악 적합 방식으로 메모리를 할당하면 프로세스는 빈 공간 B에 할당됨

<br>

### 외부 단편화
- 프로세스들이 메모리에 연속적으로 할당되는 환경에서는 프로세스들이 실행되고 종료되기를 반복하며 메모리 사이 사이에 빈 공간들이 생김
- 프로세스 바깥에 생기는 이러한 빈 공간들은 분명 빈 공간이지만 그 공간보다 큰 프로세스를 적재하기 어려운 상황을 초래하며 결국 메모리 낭비가 됨
- 이러한 현상을 외부 단편화라고 함
- 외부 단편화를 해결할 수 있는 대표적인 방안으로 메모리를 **압축**하는 방법이 있으며 메모리 조각 모음이라고도 부름
- 압축은 여기저기 흩어져 있는 빈 공간들을 하나로 모으는 방식으로 메모리 내에 저장된 프로세스를 적당히 재배치시켜 여기저기 흩어져 있는 작은 빈 공간들을 하나의 큰 빈 공간으로 만드는 방법
- 다만 압축 방식은 여러 단점이 있음
  - 작은 빈 공간들을 하나로 모으는 동안 시스템은 하던 일을 중지해야 하고, 메모리에 있는 내용을 옮기는 작업은 많은 오버헤드를 야기하며, 어떤 프로세스를 어떻게 움직여야 오버헤드를 최소화하며 압축할 수 있는지에 대한 명확한 방법을 결정하기 어려움
- 외부 단편화를 없앨 수 있는 또 다른 해결 방안으로 오늘날까지도 사용되는 가상 메모리 기법이 있으며 그 중에서도 페이징 기법이 있음



