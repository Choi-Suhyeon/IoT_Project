# 08. Device Controller & Device Driver

## Device Controller
**device controller** : 입출력 장치는 다양한 만큼 속도, 전송 형식 등이 다르며, 데이터 전송률이 CPU나 메모리보다 많이 느림. 따라서 이들은 직접 연결하지 않고 장치 컨트롤러에 하드웨어에 연결됨.

**역할** : CPU와 입출력 장치 간 통신 중개, 오류 검출, 데이터 버퍼링(속도 차이를 해결).

## Device Driver
**device driver** : 장치 컨트롤러의 동작을 감지하고 제어하는 소프트웨어. 장치 컨트롤러와 컴퓨터 내부가 서로 정보를 주고 받을 수 있도록 만들어줌.

## 다양한 입출력 방식
### 프로그램 기반 입출력
프로그램의 명령어에 의해 입출력이 시작됨. CPU가 데이터 전송에 관여한다는 특징이 있음. 대표적인 예시는 PATA지만, PATA는 DMA로도 동작하기 때문에 레거시 장치들이 아니면 잘 사용되지 않음.

**MMIO(Memory-Mapped I/O)** : 프로그램이 사용하는 주소 공간에 I/O장치가 매핑되고 여기로 전송을 수행해야 함. 다르지 않은 명령어를 사용.

**PMIO(Port-Mapped I/O)** : 프로그램이 사용하는 주소 공간 외부에 특수한 메모리 공간에 I/O장치가 매핑되고 여기를 통해 전송을 수행해야 함. 별도의 명령어를 사용. 귀중한 리소스가 I/O에 의해 소비되지 않아 주소 공간이 작은 초기 마이크로프로세서에서 애용됨.

### 인터럽트 기반 입출력
CPU가 장치 컨트롤러에게 입출력 작업을 명령하고, 장치 컨트롤러가 인터럽트를 통해 CPU에게 요청을 보내면 CPU가 인터럽트 서비스 루틴을 실행하는 것을 인터럽트 기반 입출력이라고 함.

이때, 여러 인터럽트가 동시에 발생할 수 있는데 이 때는 인터럽트의 우선순위에 따라 동작 방식이 결정됨. 처리 중인 인터럽트가 새로 발생한 인터럽트보다 우선순위가 높으면, 처리 중인 거 마저 다 처리하고 이후에 처리함. 만약 새로 발생한 인터럽트가 우선순위가 더 높으면 새로 발생한 인터럽트부터 처리하고 다시 돌아옴.

이걸 관리하는 장치가 PIC(Programmable Interrupt Controller). 인터럽트 요청들의 우선순위를 판별한 후 CPU에게 지금 처리해야 하는 인터럽트를 알려줌.

### DMA 입출력
CPU가 입출력에 관여하면 대용량 데이터가 이동하는 등의 작업에서는 CPU가 받는 부담이 커지기 때문에 DMA가 등장.

**DMA(Direct Memory Acces)** : CPU는 DMA에 입출력 관련 명령을 내리고 DMA는 입출력 작업을 수행. 필요하면 메모리에 직접 접근. 작업이 완료되면 CPU에 인터럽트를 검. 이걸 하려면 DMA Controller가 필요함.